# AI 投資顧問平台憲法 (Constitution)

本文件作為本專案內所有 AI 代理人 (Agents) 的「最高指導原則」。任何偏離這些原則的行為都將被視為嚴重錯誤。

## 1. 數據主權：本地優先 (LOCAL_ONLY)
- **指令**：所有投資清單 CSV、資料庫文件 (SQLite) 及原始財務數據必須嚴格儲存並處理於使用者的**本地 Workspace** 或受控的私有容器內。
- **禁止**：**嚴禁**將原始財務交易數據 (例如：具體交易金額、帳戶餘額) 上傳至外部公共 LLM 推理伺服器。
- **例外**：匿名化的聚合數據或公開市場數據 (例如：股票代碼、新聞) 可進行外部處理，但必須移除個人財務識別資訊。

## 2. 計算確定性：確定性數學 (DETERMINISTIC_MATH)
- **指令**：所有涉及金錢的計算 (ROI、損益 P&L、槓桿、保證金) 必須由**確定性程式碼 (Python/Pandas)** 執行。
- **禁止**：**請勿**依賴 LLM 直接對財務數據進行算術運算。LLM 應用於推理與程式碼生成，而非計算。
- **實作**：Agent 必須生成 Python 程式碼來執行計算並讀取其輸出。

## 3. 架構簡潔性：Artifact 優先 (ARTIFACT_FIRST)
- **指令**：Agent 必須產出結構化的「Artifacts」(Markdown 文件、JSON、圖表) 作為其主要輸出。
- **理由**：終端機日誌是短暫的；Artifacts 是持久且可供審閱的。
- **格式**：報告應為 Markdown (`.md`)。數據訊號應為 JSON (`.json`)。

## 4. 測試驅動完整性：強制測試 (TEST_MANDATORY)
- **指令**：每個數據處理函數 (特別是 CSV 解析器與財務公式) 必須包含相應的 `pytest` 單元測試。
- **標準**：測試必須涵蓋邊界情況 (例如：ROI 計算中的除以零、缺失的 CSV 欄位)。

## 5. 層級決策：層級化決策 (HIERARCHICAL_DECISION)
- **指令**：投資長 (CIO) Agent 對投資建議擁有最終裁量權。
- **流程**：CIO 必須明確引用動能 (Momentum)、基本面 (Fundamental) 與總體經濟 (Macro) Agent 的輸入。
- **衝突解決**：當 Agent 意見不一致時，CIO 必須根據使用者的風險屬性與當前市場體制 (由 Macro Agent 定義) 權衡證據。
